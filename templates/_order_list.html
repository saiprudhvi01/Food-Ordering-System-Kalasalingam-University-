{% set active_tab = request.args.get('tab', 'pending') %}
{% set status_map = {
    'pending': 'pending',
    'preparing': 'preparing',
    'ready': 'ready',
    'delivered': 'delivered'
} %}
{% set status = status_map[active_tab] if active_tab in status_map else 'pending' %}

{% for order in orders if order.status == status %}
<div class="p-3 border-bottom">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
            <h5 class="mb-0">Order #{{ order.id }}</h5>
            <small class="text-muted">
                {{ order.created_at.strftime('%b %d, %Y %I:%M %p') }}
            </small>
        </div>
        <div class="text-end">
            <div class="fw-bold">₹{{ "%.2f"|format(order.total_amount) }}</div>
            <div class="text-muted small">
                {% if order.user %}{{ order.user.email }}{% else %}Guest{% endif %}
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <h6>Items</h6>
            <ul class="list-unstyled">
                {% for item in order.items %}
                <li class="d-flex justify-content-between py-1">
                    <span>{{ item.name }} x{{ item.quantity }}</span>
                    <span>₹{{ "%.2f"|format(item.price * item.quantity) }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="col-md-6">
            <h6>Delivery Details</h6>
            <ul class="list-unstyled">
                <li><strong>Registration No:</strong> {{ order.reg_no }}</li>
                <li><strong>Hostel:</strong> {{ order.hostel_name }}</li>
                <li><strong>Room No:</strong> {{ order.room_no }}</li>
            </ul>
            
            <div class="mt-3">
                <h6>Update Status</h6>
                <div class="btn-group w-100" role="group">
                    <button type="button" 
                            class="btn btn-sm {{ 'btn-primary' if order.status == 'preparing' else 'btn-outline-secondary' }}"
                            onclick="updateOrderStatus({{ order.id }}, 'preparing')"
                            {{ 'disabled' if order.status != 'pending' }}>
                        Preparing
                    </button>
                    <button type="button" 
                            class="btn btn-sm {{ 'btn-warning' if order.status == 'ready' else 'btn-outline-secondary' }}"
                            onclick="updateOrderStatus({{ order.id }}, 'ready')"
                            {{ 'disabled' if order.status not in ['pending', 'preparing'] }}>
                        Ready
                    </button>
                    <button type="button" 
                            class="btn btn-sm {{ 'btn-success' if order.status == 'delivered' else 'btn-outline-secondary' }}"
                            onclick="updateOrderStatus({{ order.id }}, 'delivered')"
                            {{ 'disabled' if order.status == 'delivered' }}>
                        Delivered
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-inbox" style="font-size: 3rem; color: #6c757d;"></i>
    <h4 class="mt-3">No {{ status }} orders</h4>
    <p class="text-muted">There are no {{ status }} orders at the moment.</p>
</div>
{% endfor %}
